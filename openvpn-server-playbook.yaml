---
 - 
   hosts: all
   become: yes
   vars:
     dest_config: /etc/openvpn/server.config.tgz

   tasks:
   - name: Install OpenVPN
     apt:
       name: "{{packages}}"
     vars:
       packages:
         - openvpn 

   - name: Copy OpenVPN server config files
     copy:
#       content: !vault | 
       content: | 
         $ANSIBLE_VAULT;1.1;AES256
         34663236313263633931663332343835346235356231376137393632373661366266616439643231
         6533323563633234303930666165353337396635393732380a636435626634376363643931363965
         39653266303939653339646430323266396439303562353863333965306431353231343039393034
         6238343664666139320a313762613463373931396336636234366561346465333633653337396563
         63663734656631646137333639616134643839366534393164353537623764656331633562343766
         30323033343738633239666636373866393163616461623664363462626561343930376666333066
         36333430333332663363346435366631336565336430646432323438666565376361363762306661
         62363965303663326465353765663838373265373530313531613735373537643230313364333235
         38663162333864323661346365653830656638313663636531373133393839383338656333636532
         33623665356265613363326462376638306462313066643833376539383665393035643030643330
         32353435393736386537613534623737656534653730353536343938646436663435393865343739
         61373134383534306533343831326134663333303963303461353630383163323737373161633630
         65613435346237383638666262666335336265363038656138353134323362353037326333383636
         65376438613530303339373732386338353932646430313365663161396466316461613237646665
         37623264373130326530633532393530313065343337633637366336626630333130303064316163
         32613137653130323966656436396366636533363730633935336464383064663739393330353035
         33316365626138666137613937376234333565653430623233643937633337326363613862363438
         61333534643364306261346266656431666662656137386565396332626235356661363965616133
         66376434633366373662333732333235393163613331303431653330306163643166333431316561
         63616466383139616237636535616132653434326666373434346538653237613937343236373236
         30383064366332363661343031643739623638643066653230376634353135303532306561383464
         34363665363633366561393533613965366161363566393733623134623738653133396439343431
         34336330616435393065383038616437636264386434313738383332326331383963366432666133
         66616233663130353630383562373863333765623635323033616336616531313831623662383863
         61623164653339353635623230633735383664646134313666373465623861613634303639353135
         36343638376366366264323362346338336563636165346231353162656537363238316238633364
         30653864356432653065356165313938643731306437646331626637366661386363333237653236
         36326361386633646234363734643561396132326232363963653164323435623038656637336431
         37333531316635663935313530616136306537636266316531393063356434393533333434326535
         30643134316663313835613134613039303639326234656132356539343065383565373636383732
         32316637366361396361633030636335306332386634646134633038396162323833666237383331
         65306530306432626636616561636230373363386636346239363065363331653330626633653063
         63653836383233373430363534386461626537636566323033326265623938333865373731653761
         30663862303936363761393435663533376539336663323065303937363635373132646237333538
         61363734396335316534333339353832326432396139393331333736353965626139333734643962
         32346664643839366432623364303234396538313764353236623832306261373438623131333431
         64353664343261386433613866323163316332313134353433346663306332383965383362313266
         34663535623631353262326562393462383834323938343235623231393032643539323330373530
         38303934346234346430336635653366643930333533653930333537663132326334383236636263
         30373730356663356537653863643838323232393036633563353730383632366261323936373863
         33656633346531363032306263333434363636373837346635343462326437326661613732386134
         62373733363338323233303331633864643561626462616430373533353364656530363061313663
         61383031343338383163343139666431376337373164353031373038626233643261383966663137
         39646539343937646662613533666139333135306239316437313036356162306562396539323566
         37623036316434303732326631613230373130646238323033353966373764653632626462306661
         36336539306661336466343035663965353962633937343835653664666236366130336231303036
         63366664663561323463326133626130663138666132383439363235363135353333356333303864
         66303738393262386437666166393030356536633362353639303332663466313430666131656239
         36306137376134323834623362636132346263326566666532633434356662383339666633326335
         63623765613636343438396633653336623736316238376133343637336166333566346334383063
         65323762646235643963356531643439393533373765326532363431323830356564326438633666
         38363034306336626266643538366131383263383836343938623038663232613562653536306164
         35613136633537633861626363393639616437336664616231633338323831353361346332323837
         36656436363637313966633630646135653130353464613837353564356264303335643733353265
         63653566396464633762323236613961636132633233386634376263303164393232643331363361
         37343738343731346339633663626337383738643434326531313532623463656161326231633134
         30643065356362666262376664363065333432393764346361663162383034356236613465623034
         31306263646364616431383631303931636533336462366366643839666563383835376435613037
         35613732393738333364643534313966376231336664623137663837323062363962643136303832
         37323039666639613433646633353466346164313166353439346436646630653835393531643562
         39393366333665653839666237303762313638656339303135346231313963363466626137653134
         33653362356433636663323336383934663161326364333264363035336430643432636335373836
         32376238633837666238333830643130386239356536303834383562656666343762323637303034
         31393763646263646539643163306432396536373066336531316231643662373365323835303434
         38396330373834343065653031613230616266646363626235623661383431626432306661366466
         32323465353062303639623561383661353137323361376536656365383139383238623336393566
         66363632663039336130343666343534336265353061316562316332626435383231356332343063
         62313165626638646365333939643830646337306630323937326631373062653031326265393536
         30613161666164393261343032383538333237366661316531623738336231316265386334646631
         65373863376562333866383238613765366165646531326332663163313931633330313630323639
         37393737326335363438666630303365346262393130626164356238663164333832376462326263
         35363133346465623435343765383230653933653063313262643836303962636330643862613463
         33326539323034313430373639653566313465623065643833363665363835616237643364666131
         35623639316332393337646431343063643631353832653330393232393435373637323835323238
         36313934303364626261353239656462386134363362633063663364613566316230383338613862
         61626532336163313435623864343237373432663936396235643231343739393939643630393566
         32656435363131326461353435353834643130626131366131303433653838623934323030623437
         32613262616530303563363436656431643164333836393732306433373362633736376433653832
         63386664356530386134323538366634636134646537643236343262303162613630313238643765
         37393661633036663239303737313037653636333139396339663730336531343935643264643039
         38323264336330353931656236613836346161356463386538653062636563363831346266353239
         39393533623837663239316130656534353863616333623431623165366565373366323336353138
         64393231626563663765303066373538373039376666343131366336613637636334333764333333
         33366465396438383635346261626364313933633836633366626239643935653965396665383739
         39373966623730396439303630323265366233343130356534643831356437666136373630306263
         39353130633462336136626463663337366634363131306439343738616232653363633965626464
         34353339343062346666303534396539363237353939643061616566616133316334633363666163
         37633338393465653866366539396365636166373537343862336635626130333265626338623761
         31306431353037636432663863633464313465383535373261633630366561396661353962313061
         32353839313137353133343165326139363939636435623364626365383761356338343663643030
         32663565356663653333333163663632333531633064636438373632393436666231626663313736
         33396537336332303834626630643362353562333135376632653232336538316563653633626239
         62356537303438646632333562653666646166356233633231313838316534363964626266346137
         64366330376463383934393736396365643164363465363437376165393134633639393135636537
         62663039333065326232633261343534646130623538613662636632326463346465316238383962
         30623864643737643465383139363134313261646564313839323834633065313339383865633464
         64643435636333316436633837393765616131363364653333383539653032643431353164363334
         66666130396161653630356666623439323264326638643066666338623537303433666339653337
         30663262343163386332313136356136353832316362396564393263666630633236376237666466
         35643730623832663633336364346465343863373066383164643432343636646566313261623538
         36373935333839396137383930323134336461376231333463346666396139313736646137336462
         35343133663038663132333961303365613562323433316537343239643861666133353734343464
         37623839336534623132636330383463343934373036643064396537383235343930343865623634
         31343463336164666431663663633638356561646236636264323039366130623533303839643062
         62316463613137373162613531376464386231353433343133363563396664633531646437366536
         33333931353339616163633836343361393662343164626161613434633330323533636165666164
         37643835653131613731363735363631356131383534353133386338646662356666373263303263
         37653666653566653635366439356633336364323835623661646330646333346666313865323761
         38366666353562613433636464396337383839653239393838373062663164666163393934343533
         64343438633635366635353936643363613632663935383465376334623265323166353062323834
         37653930653733643665366136333238313230363766613664636433383638613265383137393538
         37303730323937313330306336333230636535333762353634623233313236303730333334396333
         35653164326230623263313335333737373662656364666466663439636662613336613166306539
         38656238633732356432653835323361313663333662396365643631363939656161313037376337
         61373739653164663433316661323130616234303139363938663365326361393838316136633230
         38333736373164613033363934653266303439383038643635376333386632643166346238336631
         62306638663230333662373234666337353432623036643031373732613031636462323539306438
         61623538656233313064393762393135613037303536326533316165383534343833373766616335
         38616637313562653133653437326537653965343266313765363932323631356237363633373163
         63613230336663393530613264303233613762643333333731356465336337376430633962653066
         33626163353831623634653132656265666366663562356162396138626139303833626361656138
         34613236313331613231623430313463323936333932373234333837393630653335343432633937
         36306663636439313766303433343261366163356237663666356330623762366230633863336234
         64393033333562356563343035663362303161313264313864353539356135326238343531666631
         34646161366462326462363834643264356538383266636339386266616336333863393639343665
         61663462393865663063373566316136303730616432313831386436646165646661316164376133
         34666335353238643234306136353838613534393938613765396338363232356339643335643137
         35313761663230376436323061323363303363663337303333333165333935313037616262373465
         38343938663038303930643132383631633135643638376330613733363665623533643430653532
         63323839366433316261303131653664356131356266333339313434356664633466323232346466
         63396133316164353431616161333863303133346431376535333439326462303137346338613833
         63373738393164653930663465353561373763366463323634376333353661633335623436393037
         61663433353632643262663836633739633264373637646665646662323434316663633534363839
         31633432303335633938336430313134303666663134613666303165363734333430643366623138
         30393638383333653965613330613638373061393437633135333039643161383836313064313165
         66613162323934646237353634303235323066366561633939336339343632376466316435346361
         35613231326637653362373337303935663638353531383933333661326635336434363330636164
         31656334363934393636303261623034326336623163663439616333653931613566636166386130
         37666231366232646433303161373730656365666533313839346339303365383735653037636565
         30616263616237396631656535613439333063326263346566346331323762303333316539353939
         64636135616132626561353562303036636263383634333338623266643535383737353764333038
         32613466346138636663656236393030633231343034643761643762623836643263643632363337
         64313239653832623730623861646338653361386434373434653435376464313730353463343036
         30323534356634656633313638376666313136646365333261326363663863343130396430323936
         64353630386561313139653434626463666139376464343932373033313433363132653738666165
         33373737643136373431653931636161373532383231323031613364613333383365616662393835
         66393632316235666363336266316637623837633230333263343063396564633666626165393835
         62386464643237663937653836326136633532313334656164333435393234326430396533383035
         61343135333632366639306431393163323136316462346537326533366564303830333962353130
         66643632356164633930653836313065643631353639376537633639353530383636373966353633
         34643434343430613938346430313334626339663033353335666331363366393438666335646631
         30356436356430303262343337323937623866336430386637346366623933393630303564623738
         31613661323166636130616235303565316437343732303434616137353434643766653030636661
         38393961383864646565373437353961613764306136643232666335323263373163333561386365
         35623761303961663831646661313765623132313064643165376233383031383564363336303434
         30643366383034663232613966333666303565303634636564303138363032613733386537643961
         33356461383830646631363539323562303331313033393461333135376332666236373664643039
         32666134653734383236663039616333346534326366343332356564346234303539643864336139
         30393731643231653031376330383561376531643436333538343764323763333439623132376330
         35653862663066376637393163373633333439396265343838383337613666356438313937306135
         32376137356332636331656463636437326338396632353031633635653834393764636431393536
         62623835623638616137373636333438363066313731396565313065636638396630326632623939
         36653933343362373864323336313539633034383035656164623837656638383735373131393838
         63346263323535356566326262393563636535643565613731333438383063326363633331353339
         32383538636434366433383531373566393839353533306463353035313134623135366461666631
         36393433343362616464636636393035623938303734323662646462313066663866373861656435
         36363961366630643031633137333030643362643763386364373839396531333233383262363936
         36343730626264376665383232623061623435393938316539376331623438303332316638643766
         38343262613334393664656363343464356366616430336633333464613134646561306638343733
         65343231656433336563333762306438393433653233333561353234383436623838323033303165
         62626634633835613032613931373932346139336234613335366466616261366434333534393932
         32373064633237323338323763393165666637333565303864613135323533326433323331653230
         65393938383936316534356661363835623234333135623831363234316464306631633332376237
         35343961353365643661376433643938656366373133656137303632333738613762303164326430
         35646636346261386565396630343038363732393738643435326235613931633631663766373139
         34326661623239333331616463326334333739663061326166396130303235636164316435653436
         34303965363563326263326237653232303733373765393837623438653337346265613464313236
         34333066393932623962323362393835333333386538646332393636643562396537313639373830
         31646430363636366663373432613333633864626633373063323630643432373761646238653234
         34393832316339663066326566623361353335626138393562306664333438643932343031363231
         62393631366132343836666265386132313964373433323433653837333462623530663661386439
         64313830323262633934346264303163653165653337363462353261346238353133626333343531
         31303435336132346336313632393831666132326362356332373138653434373832303433626637
         36353136613231626161653536633563653264343439336335373863353035393738616464333138
         36363161633337633431643436353331396666613465356631666164633237313239653065663437
         63383936636264356263336630343238383135373530393534643532323837386131633636613336
         63346361646336363938373663383430613766333138346262303435633433323131333363343962
         33623562613366643063396164616433383236376332363536393130323339623364376562373862
         61333231333132643135636436373066386539663933663031666539383261336464323466383432
         65386336653461343132303337613164343833353238383136343730636138383330306539363364
         30643262653131666661366464613933663861666463373531396438656339393232343032373537
         63666536326636663634336439323634323337353835333130333735643433373962336433333136
         31366333643434653035353034333366346637636465653232383862353461663166343739616535
         65316562666330613532386632663935633566343238306665613161343933636535346534343932
         63386635323939636561663033393663656530373135393263643233333434396464643237656337
         33336562363363366234376330333535626666653033613965653132343833383536343037663831
         33356261646130376666386166613133613262643830316431323536626462356237316333326562
         35393439373138323939653435663162383331356630313864653438393933633734333666313262
         303637386336363337343962363064613534
       dest: "{{ dest_config }}"
       owner: root
       group: root
       mode: 0600

   - name: Untar config for OpenVPN
     unarchive:
       src: "{{ dest_config }}"
       remote_src: yes
       dest: /etc/openvpn/

   - name: Enable and start OpenVPN
     systemd:
       name: openvpn
       state: restarted
       enabled: yes
       
